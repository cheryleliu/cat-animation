<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MusePiece Â· Cat Demo</title>
  <style>
    /* ===== å…¨å±€ ===== */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background:#0b0b0b; color:#111;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .page { height: 100dvh; width: 100vw; display:grid; place-items:center; }
    .stage {
      position: relative; aspect-ratio: 9 / 16;
      width: min(100vw, 56.25vh);
      background:#000; overflow:hidden; border-radius:16px;
    }

    /* ===== è§†é¢‘ï¼ˆé˜²â€œå°¾å·´è´´è¾¹å˜ç»†â€ï¼‰ ===== */
    :root{
      --video-scale: 1.03;      /* å®‰å…¨è¾¹è· */
      --video-pos-x: 50%;
      --video-pos-y: 52%;       /* ç¨æŠ¬é«˜ä¸€ç‚¹ */
    }
    .video-layer { position:absolute; inset:0; overflow:hidden; }
    video{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit: cover;
      object-position: var(--video-pos-x) var(--video-pos-y);
      transform: scale(var(--video-scale)) translateZ(0);
      transform-origin: center center; background:#000;
    }

    /* ===== è¦†ç›–å±‚ ===== */
    .overlay { position:absolute; inset:0; pointer-events:none; }

    /* ===== æ°”æ³¡ï¼ˆåªç”¨ä½ çš„ PNGï¼›ä¸åŠ ä»»ä½•ç™½åº•/æ¯›ç»ç’ƒ/æè¾¹ï¼‰ ===== */
    .bubble{
      /* è¿™å‡ ä¸ªå˜é‡å¯è°ƒï¼šPC æ›´å¤§ã€æ‰‹æœºåª’ä½“æŸ¥è¯¢é‡Œä¼šå˜å° */
      --bubble-width: 96%;
      --bubble-aspect: 1.70;        /* JS ä¼šè‡ªåŠ¨æ”¹æˆå›¾ç‰‡çœŸå®æ¯”ä¾‹ */
      --bubble-top: 6%;             /* ä¼šå åŠ å®‰å…¨åŒº */
      --bubble-left: 50%;
      position:absolute;
      left: var(--bubble-left);
      top: calc(var(--bubble-top) + env(safe-area-inset-top, 0px));
      width: min(var(--bubble-width), 780px);
      height: calc(min(var(--bubble-width), 780px) / var(--bubble-aspect));
      transform: translateX(-50%);
      /* å…³é”®ï¼šåªæ¸²æŸ“ä½ çš„åŠé€æ˜ PNGï¼Œå°¾å·´ä¿ç•™ */
      background: url("cat_bubble.png") center / contain no-repeat;
      /* å…è®¸ PNG è¶…å‡ºå®¹å™¨è¾¹ç¼˜ï¼ˆä¿ç•™å°¾å·´å½¢çŠ¶ï¼‰ */
      overflow: visible;
      /* ä¸å†ç”¨åœ†è§’ï¼Œä»¥å…è£æ‰å°¾å·´å¤–æ²¿ */
      border-radius: 0;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.14));
    }
    .bubble__text{
      /* æ–‡å­—å®‰å…¨åŒºï¼ˆæŒ‰ä½ çš„çŸ©å½¢å†…éƒ¨æ¥ï¼‰ */
      --padX: 8%; --padTop: 11%; --padBottom: 13%;
      position:absolute; left:var(--padX); right:var(--padX);
      top:var(--padTop); bottom:var(--padBottom);
      overflow:hidden; word-break:break-word; hyphens:auto;
      text-align:center; color:#0f172a; line-height:1.35; letter-spacing:.2px;
      font-size:26px; /* JS ä¼šæŒ‰éœ€ç¼©å°ï¼Œé•¿å¥ä¸å‡ºæ¡† */
    }

    /* ===== è¾“å…¥æ¡†ï¼ˆåªç”¨ä½ çš„æµ…ç»¿è‰² PNGï¼‰ ===== */
    .composer{
      --composer-width: 92%;
      --composer-aspect: 7.5;         /* JS ä¼šè‡ªåŠ¨æ”¹æˆå›¾ç‰‡çœŸå®æ¯”ä¾‹ */
      --composer-bottom: 3%;
      position:absolute; left:50%;
      bottom: calc(var(--composer-bottom) + env(safe-area-inset-bottom, 0px));
      width: var(--composer-width);
      height: calc(var(--composer-width) / var(--composer-aspect));
      transform: translateX(-50%);
      /* åªæ¸²æŸ“ä½ çš„ PNGï¼ˆåŠé€æ˜ã€æµ…ç»¿è‰²ï¼‰ */
      background: url("input_box.png") center / 100% 100% no-repeat;
      /* ä¸åŠ ç™½åº•ï¼Œç¡®ä¿åŠé€æ˜çœŸå®ç”Ÿæ•ˆ */
      border: none; box-shadow: 0 6px 16px rgba(0,0,0,.16);
      display:grid; grid-template-columns: 1fr auto; align-items:center;
      padding: 0 clamp(12px, 2.2%, 16px); gap: clamp(8px, 1.8vw, 12px);
      pointer-events:auto; z-index:10;
    }
    .composer input[type="text"]{
      width:100%; border:none; outline:none; background:transparent;
      font-size:18px; line-height:1.2; color:#1a1a1a;
    }
    .composer input::placeholder{ color:#6b7280; opacity:.9; }
    .btn{
      border:none; outline:none; border-radius:14px; padding:10px 14px;
      font-size:16px; background:#111827; color:#fff; cursor:pointer;
      box-shadow:0 4px 12px rgba(0,0,0,.22);
    }

    /* iOS è‡ªåŠ¨æ’­æ”¾é—¨ç¦ */
    .gate{ position:absolute; inset:0; display:grid; place-items:center;
           background: rgba(0,0,0,.5); color:#fff; pointer-events:auto; }
    .gate[hidden]{ display:none; }

    /* ===== å“åº”å¼ï¼šæ‰‹æœºç«¯æŠŠæ°”æ³¡ç¼©å°äº›ï¼Œä¸æŒ¡çŒ« ===== */
    @media (max-width: 480px){
      .bubble{
        --bubble-width: 84%;
        --bubble-top: 5%;
        width: var(--bubble-width);
        height: calc(var(--bubble-width) / var(--bubble-aspect));
      }
      .bubble__text{ --padX: 9%; --padTop: 10%; --padBottom: 12%; }
      .composer{ --composer-width: 92%; --composer-bottom: 2.2%; }
    }
    /* iPad ç«–å±å¾®è°ƒ */
    @media (min-width: 768px) and (max-width: 1024px) and (orientation: portrait){
      .bubble{ --bubble-width: 90%; --bubble-top: 6.5%; width: var(--bubble-width);
               height: calc(var(--bubble-width) / var(--bubble-aspect)); }
    }
  </style>
</head>
<body>
  <div class="page">
    <main class="stage" id="stage">
      <!-- è§†é¢‘å±‚ï¼šä¸€æ¬¡æ€§å¼€åœº + å¾ªç¯ -->
      <div class="video-layer">
        <video id="vidIntro" playsinline muted preload="auto">
          <source src="cat-yawn-blink.mp4" type="video/mp4" />
        </video>
        <video id="vidLoop" playsinline muted preload="auto" loop hidden>
          <source src="cat-blink-loop.mp4" type="video/mp4" />
        </video>
      </div>

      <!-- è¦†ç›–å±‚ï¼šåŠé€æ˜æ°”æ³¡ + è¾“å…¥æ¡† + é—¨ç¦ -->
      <div class="overlay">
        <section class="bubble" aria-live="polite" aria-atomic="true">
          <div class="bubble__text" id="bubbleText">Mew~ Been waiting for you.</div>
        </section>

        <form class="composer" id="composer" autocomplete="off">
          <input id="userInput" type="text" name="q" placeholder="Type what youâ€™re feelingâ€¦" maxlength="280" />
          <button class="btn" id="sendBtn" type="submit">Send</button>
        </form>

        <div class="gate" id="gate">
          <div style="background: rgba(255,255,255,.12); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,.2); border-radius: 16px; padding: 14px 16px; max-width: 80%; text-align: center;">
            <div style="font-weight:600; font-size: 16px; margin-bottom: 6px;">Tap to enter</div>
            <div style="opacity:.9; font-size: 14px;">If video doesnâ€™t start automatically, tap anywhere to begin. ğŸ¾</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const $ = (s, r=document)=>r.querySelector(s);
    const vidIntro = $('#vidIntro'), vidLoop = $('#vidLoop'), gate = $('#gate');
    const bubbleText = $('#bubbleText'), input = $('#userInput'), form = $('#composer');

    // è‡ªåŠ¨æ’­æ”¾ï¼ˆå¤±è´¥åˆ™æ˜¾ç¤ºé—¨ç¦ï¼‰
    async function startPlayback(){ try{ await vidIntro.play(); gate.hidden = true; } catch{ gate.hidden = false; } }
    function swapToLoop(){ vidIntro.hidden = true; vidLoop.hidden = false; vidLoop.currentTime = 0; vidLoop.play().catch(()=>{}); }

    // æ–‡æ¡ˆè‡ªåŠ¨ç¼©æ”¾ï¼šé•¿å¥ä¸å‡ºæ¡†ï¼ŒçŸ­å¥æ›´å¤§
    function fitText(el, {min=14, max=30}={}) {
      const box = el.parentElement; let size = max; el.style.fontSize = size + 'px';
      while (size > min && el.scrollHeight > box.clientHeight) { size -= 1; el.style.fontSize = size + 'px'; }
    }

    // è¯»å– PNG å®é™…æ¯”ä¾‹ï¼Œè‡ªåŠ¨è®¾ç½® --bubble-aspect / --composer-aspectï¼ˆä¿è¯ä¸å˜å½¢ï¼‰
    function autoAspect(varName, src){
      const img = new Image();
      img.onload = () => { if (img.naturalWidth && img.naturalHeight)
        document.documentElement.style.setProperty(varName, img.naturalWidth / img.naturalHeight); };
      img.src = src + '?v=' + Date.now(); // é˜²ç¼“å­˜
    }

    (function init(){
      vidIntro.addEventListener('error', swapToLoop);
      vidIntro.addEventListener('ended', swapToLoop);
      if (document.visibilityState === 'visible') startPlayback();
      document.addEventListener('visibilitychange', ()=>{ if (document.visibilityState === 'visible' && gate.hidden === false) startPlayback(); });
      gate.addEventListener('click', startPlayback, { passive:true });

      fitText(bubbleText, {min:14, max:30});
      autoAspect('--bubble-aspect',  'cat_bubble.png');
      autoAspect('--composer-aspect','input_box.png');

      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const text = (input.value || '').trim();
        if(!text) return;
        bubbleText.textContent = text; fitText(bubbleText, {min:14, max:30}); input.value = '';
        setTimeout(()=>{
          const replies = [
            'Got it. Iâ€™m here. Want to tell me a bit more?',
            'Iâ€™m listening. What feeling is strongest right now?',
            'Letâ€™s breathe together for 3 secondsâ€¦ and then keep going.'
          ];
          bubbleText.textContent = replies[Math.floor(Math.random()*replies.length)];
          fitText(bubbleText, {min:14, max:30});
        }, 900);
      });
    })();
  </script>
</body>
</html>
